# Generated by sila2.code_generator; sila2.__version__: 0.14.0
from __future__ import annotations

from abc import ABC, abstractmethod
from datetime import timedelta
from queue import Queue
from typing import TYPE_CHECKING, Any, Optional, Union

from sila2.server import FeatureImplementationBase, MetadataDict, ObservableCommandInstanceWithIntermediateResponses

from .temperaturecontroller_types import (
    AbortExperiment_Responses,
    SetTemperature_IntermediateResponses,
    SetTemperature_Responses,
)

if TYPE_CHECKING:

    from ...server import Server


class TemperatureControllerBase(FeatureImplementationBase, ABC):
    parent_server: Server

    _CurrentTemperature_producer_queue: Queue[Union[float, Exception]]
    _CurrentTemperature_current_value: float

    _TargetTemperature_producer_queue: Queue[Union[float, Exception]]
    _TargetTemperature_current_value: float

    _HeatingStatus_producer_queue: Queue[Union[Any, Exception]]
    _HeatingStatus_current_value: Any

    SetTemperature_default_lifetime_of_execution: Optional[timedelta]

    def __init__(self, parent_server: Server):
        """
        Controls temperature of laboratory devices with real-time monitoring and progress streaming
        """
        super().__init__(parent_server=parent_server)

        self._CurrentTemperature_producer_queue = Queue()

        self._TargetTemperature_producer_queue = Queue()

        self._HeatingStatus_producer_queue = Queue()

        self.SetTemperature_default_lifetime_of_execution = None

    def update_CurrentTemperature(self, CurrentTemperature: float, queue: Optional[Queue[float]] = None) -> None:
        """
        Current temperature reading in Celsius

        This method updates the observable property 'CurrentTemperature'.

        :param queue: The queue to send updates to. If None, the default Queue will be used.
        """
        if queue is None:
            queue = self._CurrentTemperature_producer_queue
            self._CurrentTemperature_current_value = CurrentTemperature
        queue.put(CurrentTemperature)

    def CurrentTemperature_on_subscription(self, *, metadata: MetadataDict) -> Optional[Queue[float]]:
        """
        Current temperature reading in Celsius

        This method is called when a client subscribes to the observable property 'CurrentTemperature'

        :param metadata: The SiLA Client Metadata attached to the call
        :return: Optional `Queue` that should be used for updating this property.
            If None, the default Queue will be used.
        """

    def abort_CurrentTemperature_subscriptions(self, error: Exception, queue: Optional[Queue[float]] = None) -> None:
        """
        Current temperature reading in Celsius

        This method aborts subscriptions to the observable property 'CurrentTemperature'.

        :param error: The Exception to be sent to the subscribing client.
            If it is no DefinedExecutionError or UndefinedExecutionError, it will be wrapped in an UndefinedExecutionError.
        :param queue: The queue to abort. If None, the default Queue will be used.
        """
        if queue is None:
            queue = self._CurrentTemperature_producer_queue
        queue.put(error)

    @property
    def current_CurrentTemperature(self) -> float:
        try:
            return self._CurrentTemperature_current_value
        except AttributeError:
            raise AttributeError("Observable property CurrentTemperature has never been set")

    def update_TargetTemperature(self, TargetTemperature: float, queue: Optional[Queue[float]] = None) -> None:
        """
        Target temperature setting in Celsius

        This method updates the observable property 'TargetTemperature'.

        :param queue: The queue to send updates to. If None, the default Queue will be used.
        """
        if queue is None:
            queue = self._TargetTemperature_producer_queue
            self._TargetTemperature_current_value = TargetTemperature
        queue.put(TargetTemperature)

    def TargetTemperature_on_subscription(self, *, metadata: MetadataDict) -> Optional[Queue[float]]:
        """
        Target temperature setting in Celsius

        This method is called when a client subscribes to the observable property 'TargetTemperature'

        :param metadata: The SiLA Client Metadata attached to the call
        :return: Optional `Queue` that should be used for updating this property.
            If None, the default Queue will be used.
        """

    def abort_TargetTemperature_subscriptions(self, error: Exception, queue: Optional[Queue[float]] = None) -> None:
        """
        Target temperature setting in Celsius

        This method aborts subscriptions to the observable property 'TargetTemperature'.

        :param error: The Exception to be sent to the subscribing client.
            If it is no DefinedExecutionError or UndefinedExecutionError, it will be wrapped in an UndefinedExecutionError.
        :param queue: The queue to abort. If None, the default Queue will be used.
        """
        if queue is None:
            queue = self._TargetTemperature_producer_queue
        queue.put(error)

    @property
    def current_TargetTemperature(self) -> float:
        try:
            return self._TargetTemperature_current_value
        except AttributeError:
            raise AttributeError("Observable property TargetTemperature has never been set")

    def update_HeatingStatus(self, HeatingStatus: Any, queue: Optional[Queue[Any]] = None) -> None:
        """
        Current heating status and scenario information

        This method updates the observable property 'HeatingStatus'.

        :param queue: The queue to send updates to. If None, the default Queue will be used.
        """
        if queue is None:
            queue = self._HeatingStatus_producer_queue
            self._HeatingStatus_current_value = HeatingStatus
        queue.put(HeatingStatus)

    def HeatingStatus_on_subscription(self, *, metadata: MetadataDict) -> Optional[Queue[Any]]:
        """
        Current heating status and scenario information

        This method is called when a client subscribes to the observable property 'HeatingStatus'

        :param metadata: The SiLA Client Metadata attached to the call
        :return: Optional `Queue` that should be used for updating this property.
            If None, the default Queue will be used.
        """

    def abort_HeatingStatus_subscriptions(self, error: Exception, queue: Optional[Queue[Any]] = None) -> None:
        """
        Current heating status and scenario information

        This method aborts subscriptions to the observable property 'HeatingStatus'.

        :param error: The Exception to be sent to the subscribing client.
            If it is no DefinedExecutionError or UndefinedExecutionError, it will be wrapped in an UndefinedExecutionError.
        :param queue: The queue to abort. If None, the default Queue will be used.
        """
        if queue is None:
            queue = self._HeatingStatus_producer_queue
        queue.put(error)

    @property
    def current_HeatingStatus(self) -> Any:
        try:
            return self._HeatingStatus_current_value
        except AttributeError:
            raise AttributeError("Observable property HeatingStatus has never been set")

    @abstractmethod
    def AbortExperiment(self, *, metadata: MetadataDict) -> AbortExperiment_Responses:
        """
        Abort current temperature control experiment


        :param metadata: The SiLA Client Metadata attached to the call

        """

    @abstractmethod
    def SetTemperature(
        self,
        TargetTemperature: float,
        *,
        metadata: MetadataDict,
        instance: ObservableCommandInstanceWithIntermediateResponses[SetTemperature_IntermediateResponses],
    ) -> SetTemperature_Responses:
        """
        Set target temperature with real-time progress updates


        :param TargetTemperature: Target temperature in Celsius

        :param metadata: The SiLA Client Metadata attached to the call
        :param instance: The command instance, enabling sending status updates to subscribed clients

        """

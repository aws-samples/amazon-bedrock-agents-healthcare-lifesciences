# Generated by sila2.code_generator; sila2.__version__: 0.14.0
from __future__ import annotations

from typing import TYPE_CHECKING

from sila2.server import MetadataDict

from ..generated.devicemanagement import (
    DeviceManagementBase,
    GetDeviceInfo_Responses,
    GetDeviceStatus_Responses,
    ListDevices_Responses,
)

if TYPE_CHECKING:
    from ..server import Server


class DeviceManagementImpl(DeviceManagementBase):
    def __init__(self, parent_server: Server) -> None:
        super().__init__(parent_server=parent_server)
        self.devices = {
            'hplc': {'name': 'HPLC System', 'status': 'ready', 'type': 'HPLC'},
            'gc': {'name': 'Gas Chromatograph', 'status': 'ready', 'type': 'GC'},
            'lcms': {'name': 'LC-MS System', 'status': 'ready', 'type': 'LCMS'}
        }

    def ListDevices(self, *, metadata: MetadataDict) -> ListDevices_Responses:
        return ListDevices_Responses(Devices=list(self.devices.keys()))

    def GetDeviceInfo(self, DeviceId: str, *, metadata: MetadataDict) -> GetDeviceInfo_Responses:
        if DeviceId in self.devices:
            info = self.devices[DeviceId]
            device_info = {
                'DeviceId': DeviceId,
                'DeviceType': info['type'],
                'Manufacturer': 'AWS Lab Automation'
            }
            return GetDeviceInfo_Responses(DeviceInfo=device_info)
        device_info = {
            'DeviceId': DeviceId,
            'DeviceType': 'Unknown',
            'Manufacturer': 'Unknown'
        }
        return GetDeviceInfo_Responses(DeviceInfo=device_info)

    def GetDeviceStatus(self, DeviceId: str, *, metadata: MetadataDict) -> GetDeviceStatus_Responses:
        if DeviceId in self.devices:
            device_status = {
                'Status': self.devices[DeviceId]['status'],
                'CurrentTemperature': 25.0,
                'IsConnected': True
            }
            return GetDeviceStatus_Responses(DeviceStatus=device_status)
        device_status = {
            'Status': 'unknown',
            'CurrentTemperature': 0.0,
            'IsConnected': False
        }
        return GetDeviceStatus_Responses(DeviceStatus=device_status)

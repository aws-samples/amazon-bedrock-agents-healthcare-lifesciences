# SiLA2 Migration Overview

**Status**: Ready to Execute  
**Estimated Effort**: 26 hours (3-4 days)  
**Prerequisites**: ✅ Backup created, ✅ AWS resources deleted

---

## Migration Strategy

### From: Custom gRPC → To: SiLA2 Standard

```
Before:  AgentCore → MCP Gateway → Bridge (Custom gRPC) → Devices (Custom gRPC)
After:   AgentCore → MCP Gateway → Bridge (SiLA2 Client) → Devices (SiLA2 Server)
```

**Key Decision**: Feature-based MCP Tools with simple bridge pass-through

---

## Execution Phases

| Phase | Focus | Duration | Files |
|-------|-------|----------|-------|
| **1. Cleanup** | Remove custom gRPC | 0.5h | Delete proto/, grpc_client.py |
| **2. Features** | Define SiLA2 Features | 5h | Create .sila.xml files |
| **3. Devices** | Implement SiLA2 Server | 12h | Rewrite server.py + implementations |
| **4. Bridge** | Implement SiLA2 Client | 6h | Create sila2_bridge.py, update MCP |
| **5. Testing** | Integration validation | 2.5h | Docker Compose + E2E tests |

**Total**: 26 hours

---

## File Changes Summary

### Delete (Phase 1)
```
src/proto/                    # All custom .proto files
src/devices/proto/            # Device-side proto
src/bridge/proto/             # Bridge-side proto
src/bridge/grpc_client.py     # Custom gRPC client
```

### Create (Phases 2-4)
```
src/devices/features/                      # SiLA2 Feature definitions
├── TemperatureController.sila.xml
├── DeviceManagement.sila.xml
└── TaskManagement.sila.xml

src/devices/feature_implementations/       # Feature implementations
├── temperaturecontroller_impl.py
├── devicemanagement_impl.py
└── taskmanagement_impl.py

src/devices/generated/                     # Auto-generated by sila2-codegen

src/bridge/sila2_bridge.py                # SiLA2 Client wrapper
```

### Modify (Phases 3-4)
```
src/devices/server.py              # Complete rewrite with SilaServer
src/devices/requirements.txt       # Add sila2>=0.14.0, sila2[codegen]
src/bridge/mcp_server.py          # Update tool definitions
src/bridge/requirements.txt        # Add sila2>=0.14.0
```

---

## SiLA2 Features Design

### 3 Features, 10 MCP Tools

| Feature | Commands | Properties | Observable |
|---------|----------|------------|------------|
| **TemperatureController** | SetTemperature, AbortExperiment | CurrentTemperature, TargetTemperature, HeatingStatus | Yes |
| **DeviceManagement** | ListDevices, GetDeviceInfo, GetDeviceStatus | - | No |
| **TaskManagement** | GetTaskStatus, GetTaskInfo | - | No |

**Key Pattern**: Unobservable Commands with Intermediate Responses
- `SetTemperature`: Long-running async command with progress streaming
- Observable Properties: Real-time temperature monitoring

---

## Validation Checklist

### Phase Completion
- [ ] Phase 1: Custom gRPC files deleted
- [ ] Phase 2: 3 .sila.xml files created, code generated
- [ ] Phase 3: SiLA2 Server running on port 50051
- [ ] Phase 4: Bridge connects to SiLA2 Server
- [ ] Phase 5: All 10 MCP tools working

### Integration Tests
- [ ] Docker Compose stack starts successfully
- [ ] Device listing works
- [ ] Temperature control works
- [ ] Real-time streaming works
- [ ] Abort command works

---

## Quick Start

```bash
# Navigate to project
cd agents_catalog/32-sila2-lab-automation-agent

# Follow phase guides in order
docs/migration/01_CLEANUP.md
docs/migration/02_FEATURES.md
docs/migration/03_DEVICES.md
docs/migration/04_BRIDGE.md
docs/migration/05_TESTING.md
```

---

## Dependencies

```toml
# Both containers
sila2>=0.14.0

# Device container only
sila2[codegen]  # For code generation
```

---

## Success Criteria

✅ All custom gRPC code removed  
✅ 3 SiLA2 Features implemented  
✅ 10 MCP tools functional  
✅ Real-time streaming working  
✅ No breaking changes to external interfaces  
✅ Docker Compose stack operational
